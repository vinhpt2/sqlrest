var Com_HrmsBaoCaoPhieuLuongNV={
	run:function(p){
		NUT_DS.select({url:_context.service["hrms"].urledit+"nhanvien_v",select:"idnhansu,vitrilv,hoten",where:[["manhanvien","=","%22"+_context.user.username+"%22"]]},function(nvs){
			NUT_DS.select({url:_context.service["hrms"].urledit+"rpt_bangluonggannhat",where:[["dulieu","=",1],["madoitac","=","HABECO"],["manhanvien","=","%22"+_context.user.username+"%22"]]},function(res){
				if(res.length){
					var nv=nvs[0];
					var rec=res[0];
					var isPG=(nv.vitrilv=="BA");
					var tongthunhap=(isPG?rec.c12+rec.c13+rec.c14+rec.c15+rec.c16+rec.c17+rec.c22+rec.c26+rec.c28+rec.c37+rec.c33+rec.c32:rec.c10+rec.c14+rec.c21+rec.c16+rec.c20+rec.c22+rec.c23+rec.c33);
					var tongkhautru=(isPG?rec.c35+rec.c36+rec.c44+rec.c46:rec.c25+rec.c26+rec.c29+rec.c32+rec.c37+rec.c38);
					var thucnhan=tongthunhap-tongkhautru;
					var bangchu=num2vnword.convert(Math.round(thucnhan));
					var html='<table><caption style="color:brown"><h2>PHIẾU THANH TOÁN TIỀN LƯƠNG</h2><h3>Tháng '+rec.thang+' Năm '+rec.nam+'</h3></caption><tr><td><b>Họ và tên</b></td><td><b>'+nv.hoten+'</b></td><td><b>Ngày công</b></td><td><b>'+(isPG?rec.c11+'</b></td></tr><tr><td><b style="color:red">Thực nhận</b></td><td><b style="color:red">'+w2utils.formatNumber(thucnhan)+'</b></td><td></td><td></td></tr><tr><td><i>Bằng chữ</i></td><td colspan="3"><i>'+bangchu+' đồng chẵn</i></td></tr><tr><td colspan="4"><table border="1px" cellspacing="0px" style="width:100%"><tr style="background:skyblue"><th colspan="2">CÁC KHOẢN THU NHẬP (VNĐ)</th><th colspan="2">CÁC KHOẢN KHẤU TRỪ (VNĐ)</th></tr><tr><td>Lương cơ bản</td><td align="right">'+w2utils.formatNumber(rec.c12)+'</td><td>BHXH</td><td align="right">'+w2utils.formatNumber(rec.c35)+'</td></tr><tr><td>Phụ cấp thâm niên</td><td align="right">'+w2utils.formatNumber(rec.c13)+'</td><td>Công đoàn</td><td align="right">'+w2utils.formatNumber(rec.c36)+'</td></tr><tr><td>Phụ cấp xăng xe</td><td align="right">'+w2utils.formatNumber(rec.c14)+'</td><td>Thuế TNCN <sup>(1)</sup></td><td align="right">'+w2utils.formatNumber(rec.c44)+'</td></tr><tr><td>Phụ cấp trang điểm</td><td align="right">'+w2utils.formatNumber(rec.c15)+'</td><td>Khác <sup>(2)</sup></td><td align="right">'+w2utils.formatNumber(rec.c46)+'</td></tr><tr><td>Phụ cấp điện thoại</td><td align="right">'+w2utils.formatNumber(rec.c16)+'</td><td></td><td></td></tr><tr><td>Phụ cấp khu vực</td><td align="right">'+w2utils.formatNumber(rec.c17)+'</td><td></td><td></td></tr><tr><td>KPI 1</td><td align="right">'+w2utils.formatNumber(rec.c22)+'</td><td></td><td></td></tr><tr><td>KPI 2</td><td align="right">'+w2utils.formatNumber(rec.c26)+'</td><td></td><td></td></tr><tr><td>KPI 3</td><td align="right">'+w2utils.formatNumber(rec.c28)+'</td><td></td><td></td></tr><tr><td>Sinh nhật</td><td align="right">'+w2utils.formatNumber(rec.c37)+'</td><td></td><td></td></tr><tr><td>Thưởng lễ</td><td align="right">'+w2utils.formatNumber(rec.c33)+'</td><td></td><td></td></tr><tr><td>Hỗ trợ lương cơ bản</td><td align="right">'+w2utils.formatNumber(rec.c32)+'</td><td></td><td></td></tr><tr><td><b>Tổng thu nhập</b></td><td align="right"><b>'+w2utils.formatNumber(tongthunhap)+'</b></td><td><b>Tổng khấu trừ</b></td><td align="right"><b>'+w2utils.formatNumber(tongkhautru)+'</b></td></tr></table></td></tr><tr><td colspan="4"><i style="font-size:x-small"><ul><u>Lưu ý</u><li><sup>(1)</sup> Những trường hợp không đóng bảo hiểm (thử việc, part-time, không đủ ngày công,…) sẽ tạm trích trừ 10% thuế TNCN</li><li><sup>(2)</sup> Chi trả BHYT đối với người lao động chưa đủ công để đóng BHXH</li></ul></i></td></tr></table>':rec.c9+'</b></td></tr><tr><td><b style="color:red">Thực nhận</b></td><td><b style="color:red">'+w2utils.formatNumber(thucnhan)+'</b></td><td><b>KPI</b></td><td><b>'+(rec.c15*100)+'%</b></td></tr><tr><td><i>Bằng chữ</i></td><td colspan="3"><i>'+bangchu+' đồng chẵn</i></td></tr><tr><td colspan="4"><table border="1" style="width:100%"><tr style="background:skyblue"><th colspan="2">CÁC KHOẢN THU NHẬP (VNĐ)</th><th colspan="2">CÁC KHOẢN KHẤU TRỪ (VNĐ)</th></tr><tr><td>Lương cơ bản</td><td align="right">'+w2utils.formatNumber(rec.c10)+'</td><td>BHXH</td><td align="right">'+w2utils.formatNumber(rec.c25)+'</td></tr><tr><td>Phụ cấp (đã bao gồm 4G máy tab)</td><td align="right">'+w2utils.formatNumber(rec.c14+rec.c21)+'</td><td>Công đoàn</td><td align="right">'+w2utils.formatNumber(rec.c26)+'</td></tr><tr><td>KPIs</td><td align="right">'+w2utils.formatNumber(rec.c16)+'</td><td>Thuế TNCN <sup>(1)</sup></td><td align="right">'+w2utils.formatNumber(rec.c29)+'</td></tr><tr><td>Sinh nhật</td><td align="right">'+w2utils.formatNumber(rec.c20)+'</td><td>Truy thu</td><td align="right">'+w2utils.formatNumber(rec.c32)+'</td></tr><tr><td>Thưởng lễ, tết</td><td align="right">'+w2utils.formatNumber(rec.c22)+'</td><td>Khác <sup>(2)</sup></td><td align="right">'+w2utils.formatNumber(rec.c37+rec.c38)+'</td></tr><tr><td>Thu nhập khác</td><td align="right">'+w2utils.formatNumber(rec.c23)+'</td><td></td><td></td></tr><tr><td>Truy lĩnh</td><td align="right">'+w2utils.formatNumber(rec.c33)+'</td><td></td><td></td></tr><tr><td><b>Tổng thu nhập</b></td><td align="right"><b>'+w2utils.formatNumber(tongthunhap)+'</b></td><td><b>Tổng khấu trừ</b></td><td align="right"><b>'+w2utils.formatNumber(tongkhautru)+'</b></td></tr></table></td></tr><tr><td><b>Tạm ứng phụ cấp</b></td><td align="right"><b>'+w2utils.formatNumber(rec.c34)+'</b></td><td></td><td></td></tr><tr><td><b>Thực nhận lương cơ bản</b></td><td align="right"><b>'+w2utils.formatNumber(rec.c35)+'</b></td><td></td><td></td></tr><tr><td><b style="color:red">Thực nhận còn lại <sup>(3)</sup></b></td><td align="right"><b style="color:red">'+w2utils.formatNumber(rec.c36)+'</b></td><td></td><td></td></tr><tr><td colspan="4"><i style="font-size:x-small"><ul><u>Lưu ý</u><li><sup>(1)</sup> Những trường hợp không đóng bảo hiểm (thử việc, part-time, không đủ ngày công,…) sẽ tạm trích trừ 10% thuế TNCN</li><li><sup>(2)</sup> Chi trả BHYT đối với người lao động chưa đủ công để đóng BHXH</li><li><sup>(3)</sup> Nếu số tiền <span style="color:red">Thực nhận còn lại < 0</span> thì yêu cầu người lao động hoàn tiền về cho công ty theo số tài khoản 99826932 (Nguyễn Thị Thanh Mai) ngân hàng VPBank</li></ul></i></td></tr></table>');
					w2popup.open({
						title: '🚪 <i>Bảng lương</i> - <b>#<i>'+rec.nam+'-'+rec.thang+'</i></b>',
						modal:true,
						width: 440,
						height: 660,
						body: html,
						buttons: '<button class="w2ui-btn" onclick="w2popup.close()">⛌ Close</button>'
					});
				}else NUT.tagMsg("Không có dữ liệu Chấm công của"+_context.user.username,"yellow");
			});
		});
	}
}
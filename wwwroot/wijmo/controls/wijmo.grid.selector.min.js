/*!
    *
    * Wijmo Library 5.20232.939
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

var wijmo,__extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();!function(e){var t;(function(t){t._CLS_CB_ITEM="wj-column-selector";t._CLS_CB_GROUP="wj-column-selector-group";var i=function(){function Selector(t,i){this._col=null;this._grid=null;this._isFixedCol=!1;this._isBound=!1;this._showCheckAll=!0;this._ariaLabel="";this._clickBnd=this._click.bind(this);this._mousedownBnd=this._mousedown.bind(this);this._pressSpaceBnd=this._pressSpace.bind(this);this.columnChanging=new e.Event;this.columnChanged=new e.Event;this.itemChecked=new e.Event;this._initialize();this.column=this._getColumn(t);e.copy(this,i)}Selector.prototype._copy=function(t,i){if("column"==t&&e.isObject(i)){this.column=i;return!0}return!1};Object.defineProperty(Selector.prototype,"column",{get:function(){return this._col},set:function(t){if((t=this._getColumn(t))!=this._col&&this.onColumnChanging(new e.CancelEventArgs)){var i=this._grid;if(i){var o=i.hostElement;i.formatItem.removeHandler(this._formatItem,this);i.removeEventListener(o,"click",this._clickBnd);i.removeEventListener(o,"mousedown",this._mousedownBnd);i.removeEventListener(o,"keyup",this._pressSpaceBnd)}var n=this._col=e.asType(t,e.grid.Column,!0);this._grid=i=n?n.grid:null;this._isFixedCol=!!i&&i.columns.indexOf(n)<0;n&&!this._isBound&&(n.allowMerging=!1);i&&!this._isBound&&(i.selectionMode=e.grid.SelectionMode.Cell);if(i){o=i.hostElement;i.formatItem.addHandler(this._formatItem,this);i.addEventListener(o,"click",this._clickBnd,!0);i.addEventListener(o,"mousedown",this._mousedownBnd,!0);i.addEventListener(o,"keyup",this._pressSpaceBnd,!0)}this.onColumnChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Selector.prototype,"showCheckAll",{get:function(){return this._showCheckAll},set:function(t){if(t!=this._showCheckAll){this._showCheckAll=e.asBoolean(t);this._grid&&this._grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(Selector.prototype,"ariaLabel",{get:function(){return this._ariaLabel},set:function(e){e!=this._ariaLabel&&(this._ariaLabel=e)},enumerable:!0,configurable:!0});Selector.prototype.onColumnChanging=function(e){this.columnChanging.raise(this,e);return!e.cancel};Selector.prototype.onColumnChanged=function(e){this.columnChanged.raise(this,e)};Selector.prototype.onItemChecked=function(e){this.itemChecked.raise(this,e)};Selector.prototype._initialize=function(){};Selector.prototype._pressSpace=function(e){if("Space"===e.code){var i=e.target,o=this._grid,n=this._col,r=o.hitTest(i);if(n&&r&&r.getColumn()&&r.getColumn()._uid==n._uid){var l=i.querySelector("."+t._CLS_CB_ITEM);if(!l)return;l.click();setTimeout((function(){i.focus()}),100)}}};Selector.prototype._click=function(i){if(!i.defaultPrevented&&i.target instanceof HTMLElement){var o=this._grid,n=this._col,r=i.target,l=o.hitTest(r);if(n&&l&&l.getColumn()&&l.getColumn()._uid==n._uid){if(r instanceof HTMLInputElement&&e.hasClass(r,t._CLS_CB_ITEM)){var s=void 0,c=l.panel.rows,a=c[l.range.topRow];if(c&&o.columnHeaders.rows&&c._uid==o.columnHeaders.rows._uid){s=new e.grid.CellRange(0,0,o.rows.length-1,0);if(this._isBound){var d=o.selection;d.col=d.col2=n.index;o.select(d)}}else s=this._isGroupRow(a)?a.getCellRange():l.range;if(s.isValid){this._setRangeChecked(r.checked,s);this.onItemChecked()}o.invalidate();i.preventDefault();return}if(e.hasClass(r,"wj-cell")&&o.bigCheckboxes&&this._isBound&&(this._isFixedCol||this._isGroupRow(l.getRow()))){var u=r.querySelector("input."+t._CLS_CB_ITEM);if(u instanceof HTMLInputElement){u.click();i.preventDefault()}}}}};Selector.prototype._mousedown=function(i){var o=this._grid,n=this._col,r=o.editableCollectionView;if(this._isBound&&n&&r&&r.currentEditItem){var l=o.hitTest(i);if(l.getColumn()&&n&&l.getColumn()._uid==n._uid&&this._isGroupRow(l.getRow())){var s=e.closestClass(i.target,t._CLS_CB_GROUP);s instanceof HTMLInputElement&&s.click()}}};Selector.prototype._isGroupRow=function(t){return t instanceof e.grid.GroupRow&&(!this._grid.childItemsPath||t.getCellRange().rowSpan>1)};Selector.prototype._getRowChecked=function(e,t){void 0===t&&(t=e);for(var i=0,o=0,n=this._col._binding,r=e;r<=t&&(!i||!o);r++){var l=this._grid.rows[r],s=l.dataItem;s&&!this._isGroupRow(l)&&((this._isBound?n.getValue(s):l.isSelected)?i++:o++)}return!(!i||o)||!(o&&!i)&&null};Selector.prototype._setRangeChecked=function(t,i){var o=this,n=this._grid,r=n.rows,l=this._col,s=l?l._binding:null,c=n.selection,a=this._isBound?n.editableCollectionView:null;if(!this._isBound||!n.isReadOnly&&a&&s){var d=!1;if(a){var u=!0;a instanceof e.collections.CollectionView&&!a.refreshOnEdit&&(u=!1);if(u){d=!0;a.beginUpdate()}}n.deferUpdate((function(){for(var c=i.bottomRow;c>=i.topRow;c--){var d=r[c],u=d.dataItem;if(u)if(o._isGroupRow(d))n.childItemsPath&&!o._isBound&&(d.isSelected=t);else if(o._isBound){if(u[l.binding]!=t){a&&a.editItem(u);var h=new e.grid.CellRange(c,l.index),_=new e.grid.CellEditEndingEventArgs(n.cells,h,u[l.binding]);if(n.onCellEditEnding(_)){s.setValue(u,t);n.onCellEditEnded(_)}}}else{var g=new e.grid.CellRange(d.index,l.index);_=new e.grid.CellRangeEventArgs(n?n.cells:null,g);if(n.onSelectionChanging(_)&&d._setFlag(e.grid.RowColFlags.Selected,t,!0)){n.refreshCells(!1,!0,!0);n.onSelectionChanged(_)}}}}));if(a){a.commitEdit();d&&a.endUpdate();n.selection=c}}};Selector.prototype._formatItem=function(i,o){var n=o.getColumn(),r=i.editRange;if(n&&n==this._col&&(!r||!r.contains(o.row,o.col))&&o.panel.rows!=i.columnFooters.rows){var l=o.getRow(),s=o.cell,c="",a=void 0,d=e.grid.CellFactory._tplCtx;d.item=l.dataItem;d.row=l;d.col=n;if(o.panel.rows==i.columnHeaders.rows){if(this._showCheckAll&&o.range.bottomRow==o.panel.rows.length-1){a=this._getRowChecked(0,i.rows.length-1);c=t._CLS_CB_ITEM+" "+t._CLS_CB_GROUP}}else if(this._isGroupRow(l)){var u=l.getCellRange();a=this._getRowChecked(u.row,u.row2);c=t._CLS_CB_ITEM+" "+t._CLS_CB_GROUP}else if(l.dataItem&&!this._isBound){a=this._getRowChecked(o.row);c=t._CLS_CB_ITEM}if(c){if(this._isFixedCol||this._isBound&&this._isGroupRow(l)&&n.aggregate&&n.index>i.columns.firstVisibleIndex){var h=s.querySelector("."+e.grid.CellFactory._WJC_COLLAPSE);s.textContent="";h&&s.appendChild(h)}var _=""!=this._ariaLabel?' aria-label="'+e.evalTemplate(this._ariaLabel,d)+'"':' aria-label="Select Row"',g=e.createElement('<label><input type="checkbox" class="'+c+" "+e.grid.CellFactory._WJC_CHECKBOX+'" tabindex="-1"'+_+" /><span></span></label>"),C=g.querySelector("input");e.setChecked(C,a);e.setAttribute(s,"aria-selected",!!a);if(this._isBound&&(n.isReadOnly||i.selectionMode==e.grid.SelectionMode.None)){C.disabled=!0;C.style.cursor="default"}s.insertBefore(g,s.firstChild)}}};Selector.prototype._getColumn=function(t){if(t instanceof e.grid.FlexGrid){var i=t,o=i.rowHeaders.columns;t=i.headersVisibility&e.grid.HeadersVisibility.Row&&o.length?o[0]:i.columns[0]}this._grid&&(e.isString(t)||e.isNumber(t))&&(t=this._grid.getColumn(t));return t instanceof e.grid.Column?t:null};return Selector}();t.Selector=i;var o=function(t){__extends(BooleanChecker,t);function BooleanChecker(e,i){return t.call(this,e,i)||this}BooleanChecker.prototype.onColumnChanged=function(i){var o=this.column,n=o?o.dataType:null;e.assert(!o||null==n||n==e.DataType.Boolean,"BooleanChecker should be bound to boolean columns");t.prototype.onColumnChanged.call(this,i)};BooleanChecker.prototype._initialize=function(){this._isBound=!0};return BooleanChecker}(i);t.BooleanChecker=o})((t=e.grid||(e.grid={})).selector||(t.selector={}))}(wijmo||(wijmo={}));!function(e){!function(t){t.selector||(t.selector={}),e._registerModule("wijmo.grid.selector",e.grid.selector)}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));